blueprint:
  name: Lutron Pico Paddle - Light with Brightness Control
  description: |
    This automation allows for controlling one or more light entities with a Lutron Paddle Pico (PJ2-1P-GXX).
    A short press will toggle the light on/off, while a long press will gradually adjust brightness.

  domain: automation

  input:
    pico_remote:
      name: Pico Remote
      description: "Select the Pico remote to configure:"
      selector:
        device:
          filter:
            model: PJ2-1P-GXX (PaddleSwitchPico)
    entity:
      name: Light Entity(ies)
      description: "Light entity to control."
      selector:
        entity:
          filter:
            domain: light
          multiple: true

trigger:
  - platform: device
    device_id: !input pico_remote
    domain: lutron_caseta
    type: press
    subtype: Button 0
    id: on_pressed

  - platform: device
    device_id: !input pico_remote
    domain: lutron_caseta
    type: release
    subtype: Button 0
    id: on_releaseed

  - platform: device
    device_id: !input pico_remote
    domain: lutron_caseta
    type: press
    subtype: Button 2
    id: off_pressed

  - platform: device
    device_id: !input pico_remote
    domain: lutron_caseta
    type: release
    subtype: Button 2
    id: off_released

variables:
  cycle_delay: 750
  step_pct: 20

action:
  - choose:
      - conditions:
          - condition: trigger
            id: on_pressed
        sequence:
          - action: light.turn_on
            target:
              entity_id: !input entity
          - delay:
              milliseconds: "{{ cycle_delay }}"
          - repeat:
              sequence:
                - action: light.turn_on
                  data:
                    brightness_step_pct: "{{step_pct}}"
                  target:
                    entity_id: !input entity
                  continue_on_error: true
                - delay:
                    milliseconds: "{{ cycle_delay }}"
              until:
                - condition: numeric_state
                  entity_id: !input entity
                  attribute: brightness
                  above: 254
      - conditions:
          - condition: trigger
            id: up_released
        sequence:
          - delay:
              milliseconds: 1

      - conditions:
          - condition: trigger
            id: off_pressed
        sequence:
          - action: light.turn_on
            target:
              entity_id: !input entity
          - delay:
              milliseconds: "{{ cycle_delay }}"
          - repeat:
              sequence:
                - action: light.turn_on
                  data:
                    brightness_step_pct: "{{step_pct}}"
                  target:
                    entity_id: !input entity
                  continue_on_error: true
                - delay:
                    milliseconds: "{{ cycle_delay }}"
              until:
                - condition: numeric_state
                  entity_id: !input entity
                  attribute: brightness
                  above: 254
      - conditions:
          - condition: trigger
            id: up_released
        sequence:
          - delay:
              milliseconds: 1

mode: restart
